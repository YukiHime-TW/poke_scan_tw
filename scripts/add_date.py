import json
import os
import time

SETS_DIR = '../assets/sets'

# å°ç£ç¹é«”ä¸­æ–‡ç‰ˆ ç™¼å”®æ—¥æœŸå°ç…§è¡¨ (YYYY-MM-DD)
# è³‡æ–™ä¾†æºï¼šå°ç£å¯¶å¯å¤¢å®˜ç¶²/Wiki
SET_DATES = {
    # --- å¤ªé™½&æœˆäº® (Sun & Moon) ---
    # çœ¾æ˜Ÿé›²é›†çµ„åˆç¯‡
    "AC1a": "2019-10-09", "AC1b": "2019-10-09",
    "AC1D": "2019-10-09",
    # ç¾å¤¢æˆçœŸçµ„åˆç¯‡
    "AC2a": "2019-12-20", "AC2b": "2019-12-20",
    "AC2D": "2019-12-20",
    # é›™å€çˆ†æ“Š
    "AS5a": "2020-02-21", "AS5b": "2020-02-21",
    "AS5D": "2020-02-21",
    # å‚³èªªäº¤é‹’
    "AS6a": "2020-04-10", "AS6b": "2020-04-10",
    "AS6D": "2020-04-10",

    # --- åŠ&ç›¾ (Sword & Shield) ---
    # åŠ&ç›¾
    "SC1a": "2020-06-19", "SC1b": "2020-06-19",
    "SC1D": "2020-06-19",
    # ç„¡æ¥µåŠ›é‡
    "SC2a": "2020-08-21", "SC2b": "2020-08-21",
    "SC2D": "2020-08-21",
    # é©šå¤©ä¼ç‰¹æ”»æ“Š
    "S4": "2020-10-09",
    # é–ƒè‰²æ˜æ˜ŸV
    "S4a": "2020-11-27",
    "SCA": "2021-11-27",
    # é€£æ“Šå¤§å¸«ã€ä¸€æ“Šå¤§å¸«
    "S5I": "2021-01-29",  "S5R": "2021-01-29",
    "SCB": "2021-01-29",
    # é›™ç’§æˆ°å£«
    "S5a": "2021-04-02",
    # éŠ€ç™½æˆ°æ§ã€æ¼†é»‘å¹½é­‚
    "S6H": "2021-05-07",  "S6K": "2021-05-07",
    # ä¼Šå¸ƒè‹±é›„
    "S6a": "2021-06-11",
    "SCC": "2021-11-27",
    # æ‘©å¤©å·”å³°ã€è’¼ç©ºçƒˆæµ
    "S7D": "2021-07-23",  "S7R": "2021-07-23",
    # åŒ¯æµè—è¡“
    "S8": "2021-10-01",
    "SCD": "2021-10-01",
    # 25 é€±å¹´æ”¶è—ç‰ˆ
    "S8a": "2021-10-20", 
    # VMAXçµ•ç¾¤å£“è»¸
    "S8b": "2021-12-17",
    # æ˜Ÿæ˜Ÿèª•ç”Ÿ
    "S9": "2022-01-28",
    "SJ": "2022-01-28",
    "SK": "2022-01-28",
    "SI": "2022-02-18",
    # å°æˆ°åœ°å€
    "S9a": "2022-03-11",
    "SLL": "2022-03-11",  "SLD": "2022-03-11",
    # æ™‚é–“è§€å¯Ÿè€…ã€ç©ºé–“é­”è¡“å¸«
    "S10D": "2022-04-22", "S10P": "2022-04-22",
    # é»‘æš—äº¡éˆ
    "S10a": "2022-05-27",
    # PokÃ©mon GO
    "S10b": "2022-06-17",
    # è¿·é€”æ·±æ·µ
    "S11": "2022-07-29",  
    "SPZ": "2022-08-26",  "SPD": "2022-08-26",
    "SP6": "2022-08-26",
    # ç™½ç†±å¥§ç¥•
    "S11a": "2022-09-16",
    "SN": "2022-10-02",
    # æ€ç¶­æ¿€ç›ª
    "S12": "2022-11-04",
    "SDL": "2022-11-04", "SDP": "2022-11-04", "SDM": "2022-11-04",
    # å¤©åœ°è¬ç‰©VSTAR
    "S12a": "2022-12-16",
    "SO": "2023-01-13",

    # --- æœ±&ç´« (Scarlet & Violet) ---
    # æœ±exã€ç´«ex
    "SV1S": "2023-02-03", "SV1V": "2023-02-03",
    "SVAW": "2023-02-03", "SVAM": "2023-02-03", "SVAL": "2023-02-03",
    "SVB": "2023-03-03",
    # ä¸‰é€£éŸ³çˆ†
    "SV1a": "2023-03-24",
    "SVC": "2023-04-28",
    # å†°é›ªéšªå¢ƒã€ç¢Ÿæ—‹æš´æ“Š
    "SV2P": "2023-04-28", "SV2D": "2023-04-28",
    "SVP1": "2023-06-23",
    # å¯¶å¯å¤¢å¡ç‰Œ151
    "SV2a": "2023-06-30",
    "SVD": "2023-07-21",
    # é»¯ç„°æ”¯é…è€…
    "SV3": "2023-08-11", 
    "SVF": "2023-08-11",
    # æ¿€ç‹‚é§­æµª
    "SV3a": "2023-09-29",
    "SVEM": "2023-09-29",
    "SVEL": "2023-09-29",
    # å¤ä»£å’†å“®ã€æœªä¾†é–ƒå…‰
    "SV4K": "2023-11-10", "SV4M": "2023-11-10",
    # é–ƒè‰²å¯¶è—ex
    "SV4a": "2023-12-22",
    # ç‹‚é‡ä¹‹åŠ›ã€ç•°åº¦å¯©åˆ¤
    "SV5K": "2024-02-02", "SV5M": "2024-02-02",
    "SVHK": "2024-02-02", "SVHM": "2024-02-02",
    # ç·‹ç´…è–„éœ§
    "SV5a": "2024-04-03",
    # è®Šå¹»å‡é¢
    "SV6": "2024-05-10",
    # é»‘å¤œæ¼«éŠè€…
    "SV6a": "2024-06-21",
    # æ˜Ÿæ™¶å¥‡è·¡
    "SV7": "2024-08-02",
    # æ¨‚åœ’é¨°é¾
    "SV7a": "2024-09-27",
    "SVK": "2024-09-27",
    "SVPN": "2024-09-27",
    "SVPS": "2024-09-27",
    # è¶…é›»çªåœ
    "SV8": "2024-10-25",
    # å¤ªæ™¶æ…¶å…¸ex
    "SV8a": "2024-12-20",
    # å°æˆ°æ­æª”
    "SV9": "2025-02-07",
    "SVOM": "2025-03-07",
    "SVOD": "2025-03-07",
    # ç†±é¢¨ç«¶æŠ€å ´
    "SV9a": "2025-03-28",
    # ç«ç®­éšŠçš„æ¦®è€€
    "SV10": "2025-05-02",
    # ç´”ç™½é–ƒç„°ã€æ¼†é»‘ä¼ç‰¹
    "SV11W": "2025-06-20", "SV11B": "2025-06-20",

    # --- è¶…ç´šé€²åŒ– (Mega) ---
    # è¶…ç´šå‹‡æ°£ã€è¶…ç´šäº¤éŸ¿æ¨‚
    "M1L": "2025-08-15", "M1S": "2025-08-15",
    "MBG": "2025-09-19","MBD": "2025-09-19",
    # çƒˆç„ç‹‚ç«X
    "M2": "2025-10-09",
    # è¶…ç´šé€²åŒ–å¤¢æƒ³
    "M2a": "2025-12-05",

    # ç‰¹å…¸å¡
    "SM-P": "2019-10-9",
    "S-P": "2022-12-15", 
    "SV-P": "2023-01-26",
    "M-P": "2025-08-07" 
}

def add_dates_to_files():
    if not os.path.exists(SETS_DIR):
        print(f"âŒ æ‰¾ä¸åˆ°ç›®éŒ„: {SETS_DIR}")
        return

    print("ğŸ“… é–‹å§‹è£œé½Šæ“´å……åŒ…æ—¥æœŸ...")
    
    files = [f for f in os.listdir(SETS_DIR) if f.endswith('.json')]
    updated_files_count = 0

    for filename in files:
        file_path = os.path.join(SETS_DIR, filename)
        is_modified = False
        
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                data = json.load(f)

            # éæ­· key (å…¶å¯¦æ¯å€‹æª”æ¡ˆé€šå¸¸åªæœ‰ä¸€å€‹ keyï¼Œå°±æ˜¯ set_code)
            for set_code, set_data in data.items():

                # æª¢æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°æ—¥æœŸ
                if set_code in SET_DATES:
                    if set_data.get('releaseDate') != SET_DATES[set_code]:
                        set_data['releaseDate'] = SET_DATES[set_code]
                        is_modified = True
                else:
                    # å¦‚æœæ¸…å–®è£¡æ²’æœ‰ï¼Œçµ¦å€‹é è¨­å€¼ (ç•¶ä¸‹çš„æ—¥æœŸ)
                    today = time.strftime("%Y-%m-%d")
                    if 'releaseDate' not in set_data:
                        set_data['releaseDate'] = today
                        print(f"âš ï¸ æœªçŸ¥æ—¥æœŸçš„ç³»åˆ—: {set_code}")
                        is_modified = True

            if is_modified:
                with open(file_path, 'w', encoding='utf-8') as f:
                    json.dump(data, f, ensure_ascii=False, indent=2)
                updated_files_count += 1

        except Exception as e:
            print(f"   âŒ {filename} è™•ç†å¤±æ•—: {e}")

    print(f"âœ… æ—¥æœŸæ›´æ–°å®Œæˆï¼å…±æ›´æ–°äº† {updated_files_count} å€‹æª”æ¡ˆã€‚")

if __name__ == "__main__":
    add_dates_to_files()